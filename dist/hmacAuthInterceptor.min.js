!function(){"use strict";angular.module("hmacAuthInterceptor",["hmacAuthInterceptorSigner","hmacAuthInterceptorUtil"]).factory("hmacInterceptor",["hmacSigner","urlUtil",function(t,e){var n={host:"",whitelist:[],accessId:"",secretKey:"",headers:{contentType:"X_HMAC_CONTENT_TYPE",contentMD5:"X_HMAC_CONTENT_MD5",date:"X_HMAC_DATE",authorization:"X_HMAC_AUTHORIZATION"}},c=function(t,e){e="undefined"!=typeof e?e:!1;var c=e?n.headers[t]:n[t];return angular.isFunction(c)?c():c},r=function(t,e,c){c="undefined"!=typeof c?c:!1,c?n.headers[t]=e:n[t]=e},o=function(r){var o=e.getHost(r.url);if(o.search(c("host"))>-1){for(var u=!1,i=[].concat(c("whitelist")),a=e.getRelativePath(r.url),s=0;s<i.length;s++)if(a.search(i[s])>-1){u=!0;break}u||t.sign(r,c("accessId"),c("secretKey"),n.headers)}return r};return{set host(t){r("host",t)},get host(){return c("host")},set whitelist(t){r("whitelist",t)},get whitelist(){return c("whitelist")},set accessId(t){r("accessId",t)},get accessId(){return c("accessId")},set secretKey(t){r("secretKey",t)},get secretKey(){return c("secretKey")},headers:{set contentType(t){r("contentType",t,!0)},get contentType(){return c("contentType",!0)},set contentMD5(t){r("contentMD5",t,!0)},get contentMD5(){return c("contentMD5",!0)},set date(t){r("date",t,!0)},get date(){return c("date",!0)},set authorization(t){r("authorization",t,!0)},get authorization(){return c("authorization",!0)}},request:o}}]),angular.module("hmacAuthInterceptorSigner",["hmacAuthInterceptorUtil"]).factory("hmacSigner",["urlUtil",function(t){var e=function(t,e,r,o){n(t,o),c(t,e,r,o)},n=function(t,e){h(t,e.contentType,i(t)),h(t,e.contentMD5,a(t)),h(t,e.date,u(t))},c=function(t,e,n,c){var u=o(t,c),i="APIAuth "+e+":"+r(u,n);h(t,c.authorization,i)},r=function(t,e){return CryptoJS.HmacSHA1(t,e).toString(CryptoJS.enc.Base64)},o=function(e,n){return[f(e,n.contentType),f(e,n.contentMD5),t.getRelativePath(e.url),f(e,n.date)].join(",")},u=function(t){return f(t,"Date")||(new Date).toUTCString()},i=function(t){return f(t,"Content-Type")||""},a=function(t){var e=s(t);return CryptoJS.MD5(e).toString(CryptoJS.enc.Base64)},s=function(t){var e=t.data;return angular.isObject(e)?angular.toJson(e):e||""},f=function(t,e){return t.headers[e]},h=function(t,e,n){t.headers[e]=n};return{sign:e}}]),angular.module("hmacAuthInterceptorUtil",[]).factory("urlUtil",function(){var t=function(t){var e=document.createElement("a");return e.href=t,e},e=function(e){return t(e).host},n=function(e){return t(e).pathname};return{getHost:e,getRelativePath:n}})}();